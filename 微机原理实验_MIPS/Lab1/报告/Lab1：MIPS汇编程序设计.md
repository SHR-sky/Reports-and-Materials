# 实验一：MIPS汇编程序设计




## 实验名称

MIPS汇编程序设计

## 实验任务

编写子程序 PENO (&X,N,SP,SN)，求长度为N 的字类型数组X中所有正奇数的和和所有负偶数的和，并分别保存到 SP 和 SN 中。已知\$a0 保存 X 的地址，\$a1 保存数组长度N， 正奇数的和保存在\$v0，负偶数的和保存在\$v1 中。并编写主程序验证子程序功能，要求将计算结果输出到console。

​	测试以下数组序列

- int X\[10]={1,-4,8,-9,5,6,-10,19,22,23};

- int X\[10]={121,-124,138,-199,255,2566,-1034,1019,2032,2033};

## 实验目的

1. 熟悉常见的MIPS汇编指令
2. 掌握MIPS汇编程序设计
3. 了解MIPS汇编语言与机器语言之间的对应关系
4. 了解C语言语句与汇编指令之间的关系
5. 掌握MARS的调试技术
6. 掌握程序的内存映像

## 实验环境

**Mars MIPS汇编编译器**

## 实验设计方案

### 软件代码

```asm
# R

.data
N: .word 10
X1: .word 1,-4,8,-9,5,6,-10,19,22,23
X2: .word 121,-124,138,-199,255,2566,-1034,1019,2032,2033
ans1: .asciiz "\n the sum of posodd = "
ans2: .asciiz "\n the sum of negeven = "

.text
.globl main

main:
    la $t0 X2
    lw $t1 N
    li $v0 0
    li $v1 0

    loop:
        lw $t2,($t0)
        bgez $t2,judgeodd
        rem $t3,$t2,2
        beqz $t3,addeven
        j next

    judgeodd:
        rem $t4, $t2, 2
        bnez $t4, addodd
        j next

    addodd:
        add $v0, $v0, $t2
        j next

    addeven:
        add $v1, $v1, $t2
        j next

    next:
        addi $t0, $t0, 4
        addi $t1, $t1, -1
        bnez $t1, loop 

    # 打印结果
    move $a1, $v0 # 先把v0中存的数拿出来，避免覆盖
    li $v0, 4 # 操作数为4，系统执行打印a0操作
    la $a0, ans1 # 打印的内容
    syscall # 打印操作
    move $a0, $a1 # 把存的数拿回来，赋值给a0，准备打印
    li $v0, 1 # 操作数1，打印一个整型a0
    syscall # 打印操作

    li $v0, 4 # 操作数为4，系统执行打印a0操作
    la $a0, ans2 # 打印的内容
    syscall # 打印操作
    move $a0, $v1 # 把v1的值赋值给a0，准备打印
    li $v0, 1 # 操作数1，打印一个整型a0
    syscall # 打印操作

    # 退出程序
    li $v0, 10 # 操作数10，退出系统
    syscall # 退出系统
```

## 实验结果

程序代码段映像

|            |     |                        |     |          |
| ---------- | --- | ---------------------- | --- | -------- |
| 内存地址       |     | 汇编指令                   |     | 机器码      |
| 0x00400000 |     | lui $1 0x00001001      |     | 3c011001 |
| 0x00400004 |     | ori $8,$1,0x0000002c   |     | 34280004 |
| 0x00400008 |     | lui $1,0x00001001      |     | 3c011001 |
| 0x0040000C |     | lw $9,0x00000000($1)   |     | 8c290000 |
| 0x00400010 |     | addiu $2,$0,0x00000000 |     | 24020000 |
| 0x00400014 |     | addiu $3,$0,0x00000000 |     | 24030000 |
| 0x00400018 |     | lw $10,0x00000000($8)  |     | 8d0a0000 |
| 0x0040001C |     | bgez $10,0x00000005    |     | 5410005  |
| 0x00400020 |     | addi $1,$0,0x00000002  |     | 20010002 |
| 0x00400024 |     | div $10,$1             |     | 0141001a |
| 0x00400028 |     | mfhi $11               |     | 5810     |
| 0x0040002C |     | beq $11,$0,0x00000008  |     | 11600008 |
| 0x00400030 |     | j 0x00400058           |     | 8100016  |
| 0x00400034 |     | addi $1,$0,0x00000002  |     | 20010002 |
| 0x00400038 |     | div $10,$1             |     | 0141001a |
| 0x0040003C |     | mfhi $12               |     | 6010     |
| 0x00400040 |     | bne $12,$0,0x00000001  |     | 15800001 |
| 0x00400044 |     | j 0x00400058           |     | 8100016  |
| 0x00400048 |     | add $2,$2,$10          |     | 004a1020 |
| 0x0040004C |     | j 0x00400058           |     | 8100016  |
| 0x00400050 |     | add $3,$3,$10          |     | 006a1820 |
| 0x00400054 |     | j 0x00400058           |     | 8100016  |
| 0x00400058 |     | addi $8,$8,0x00000004  |     | 21080004 |
| 0x0040005C |     | addi $9,$9,0xffffffff  |     | 2129ffff |
| 0x00400060 |     | bne $9,$0,0xffffffed   |     | 1520ffed |
| 0x00400064 |     | addu $5,$0,$2          |     | 22821    |
| 0x00400068 |     | addiu $2,$0,0x00000004 |     | 24020004 |
| 0x0040006C |     | lui $1,0x00001001      |     | 3c011001 |
| 0x00400070 |     | ori $4,$1,0x00000054   |     | 34240054 |
| 0x00400074 |     | syscall                |     | 0000000c |
| 0x00400078 |     | addu $4,$0,$5          |     | 52021    |
| 0x0040007C |     | addiu $2,$0,0x00000001 |     | 24020001 |
| 0x00400080 |     | syscall                |     | 0000000c |
| 0x00400084 |     | addiu $2,$0,0x00000004 |     | 24020004 |
| 0x00400088 |     | lui $1,0x00001001      |     | 3c011001 |
| 0x0040008C |     | ori $4,$1,0x0000006b   |     | 34240071 |
| 0x00400090 |     | syscall                |     | 0000000c |
| 0x00400094 |     | addu $4,$0,$3          |     | 32021    |
| 0x00400098 |     | addiu $2,$0,0x00000001 |     | 24020001 |
| 0x0040009C |     | syscall                |     | 0000000c |
| 0x004000A0 |     | addiu $2,$0,0x0000000a |     | 2402000a |
| 0x004000A4 |     | syscall                |     | 0000000c |

程序数据段映像

|            |            |            |        |      |
| ---------- | ---------- | ---------- | ------ | ---- |
| 变量名     | 地址       | 数据       | 定义值 |          |
| N          | 0x10010000 | 0x0a       | 10     |      |
| X1         | 0x10010004 | 0x01       | 1      |      |
|            | 0x10010008 | 0xfffffffc | -4     |      |
|  | 0x10010012 | 0x08       | 8      |      |
|  | 0x10010016 | 0xfffffff7 | -9     |      |
|  | 0x10010020 | 0x05       | 5      |      |
|  | 0x10010024 | 0x06       | 6      |      |
|  | 0x10010028 | 0xfffffff6 | -10    |      |
|  | 0x10010032 | 0x13       | 19     |      |
|        | 0x10010036 | 0x16       | 22     |      |
|  | 0x10010040 | 0x17       | 23     |      |
| X2         | 0x10010044 | 0x79       | 121    |      |
|  | 0x10010048 | 0xffffff84 | -124   |      |
|  | 0x10010052 | 0x8a       | 138    |      |
|  | 0x10010056 | 0xffffff39 | -199   |      |
|  | 0x10010060 | 0xff       | 255    |      |
|  | 0x10010064 | 0xa06      | 2566   |      |
|  | 0x10010068 | 0xfffffbf6 | -1034  |      |
|  | 0x10010072 | 0x3fb      | 1019   |      |
|  | 0x10010076 | 0x7f0      | 2032   |      |
|  | 0x10010080 | 0x7f1      | 2033   |      |
| ans1       | 0x10010084 |   68       | h      |      |
|  | 0x10010088 | 74         | t      |      |
|  | 0x1001008C | 20         |        |      |
|  | 0x10010090 | 6d         | \n     |      |
|  | 0x10010094 | 75         | u      |      |
|  | 0x10010098 | 73         | s      |      |
|  | 0x1001009C | 20         |        |      |
|  | 0x100100A0 | 65         | e      |      |
|  | 0x100100A4 | 66         | f      |      |
|  | 0x100100A8 | 6f         | o      |      |
|  | 0x100100AC | 32         |        |      |
|  | 0x100100B0 | 109        | m      |      |
|  | 0x100100B4 | 115        | s      |      |
|  | 0x100100B8 | 111        | o      |      |
|  | 0x100100BC | 112        | p      |      |
|  | 0x100100C0 | 32         |        |      |
|  | 0x100100C4 | 32         |        |      |
|  | 0x100100C8 | 100        | d      |      |
|  | 0x100100CC | 100        | d      |      |
|  | 0x100100D0 | 111        | o      |      |
|  | 0x100100D4 | 92         | \n     |      |
|  | 0x100100D8 | 92         | \0     |      |
|  | 0x100100DC | 32         |        |      |
|  | 0x100100E0 | 61         | =      |      |
| ans2       | 0x100100E4 |     101       | e    |     |
|  | 0x100100E8 | 104        | h      |      |
|  | 0x100100EC | 116        | t      |      |
|  | 0x100100F0 | 32         |        |      |
|  | 0x100100F4 | 109        | m      |      |
|  | 0x100100F8 | 117        | u      |      |
|  | 0x100100FC | 115        | s      |      |
|  | 0x10010100 | 32         |        |      |
|  | 0x10010104 | 32         |        |      |
|  | 0x10010108 | 102        | f      |      |
|  | 0x1001010C | 111        | o      |      |
|  | 0x10010110 | 32         |        |      |
|  | 0x10010114 | 101        | e      |      |
|  | 0x10010118 | 103        | g      |      |
|  | 0x1001011C | 101        | e      |      |
|  | 0x10010120 | 110        | n      |      |
|  | 0x10010124 | 32         |        |      |
|  | 0x10010128 | 110        | n      |      |
|  | 0x1001012C | 101        | e      |      |
|  | 0x10010130 | 118        | v      |      |
|  | 0x10010134 | 92         | \0     |      |
|  | 0x10010138 | 92         | \0     |      |
|  | 0x1001013C | 32         |        |      |
|        | 0x10010140 | 61         | =      |      |

### 结果分析

![image-20240404213233554](https://cdn.jsdelivr.net/gh/SHR-sky/Picture@main/Pic/image-20240404213233554.png)

最终得到实验结果如图，观察寄存器的值可以看到相应的值，并且输出结果正常。

## 实验小结

   本次实验我使用了Mars软件进行汇编语言的练习，学会了利用syscall来进行数据的输入和输出，并且利用j指令实现了循环功能，成功得到实验结果，收获很大！